"use strict";(self.webpackChunkarce_top=self.webpackChunkarce_top||[]).push([[419],{86890:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>c,default:()=>m,frontMatter:()=>a,metadata:()=>i,toc:()=>d});var l=s(13274),r=s(99128);const a={slug:"shardingsphere-replication-of-database-and-table-shards",title:"shardingsphere\u5206\u5e93\u5206\u8868\u4e3b\u4ece\u590d\u5236",author:"Arce",author_title:"\u72ec\u7acb\u6e38\u620f\u5f00\u53d1\u8005",author_url:"https://github.com/charles0122",author_image_url:"https://avatars.githubusercontent.com/u/70085736?v=4",description:"\u6d4b\u8bd5",tags:["Java","SpringCloud","ShardingSphere"]},c="CentOS7\u5b89\u88c5docker",i={permalink:"/arcetop/blog/shardingsphere-replication-of-database-and-table-shards",editUrl:"https://github.com/charles0122/arce.top/edit/main/arce.top/blog/2023-04-08-shardingsphere-replication-of-database-and-table-shards.md",source:"@site/blog/2023-04-08-shardingsphere-replication-of-database-and-table-shards.md",title:"shardingsphere\u5206\u5e93\u5206\u8868\u4e3b\u4ece\u590d\u5236",description:"\u6d4b\u8bd5",date:"2023-04-08T00:00:00.000Z",tags:[{label:"Java",permalink:"/arcetop/blog/tags/java"},{label:"SpringCloud",permalink:"/arcetop/blog/tags/spring-cloud"},{label:"ShardingSphere",permalink:"/arcetop/blog/tags/sharding-sphere"}],readingTime:9,hasTruncateMarker:!0,authors:[{name:"Arce",title:"\u72ec\u7acb\u6e38\u620f\u5f00\u53d1\u8005",url:"https://github.com/charles0122",imageURL:"https://avatars.githubusercontent.com/u/70085736?v=4"}],frontMatter:{slug:"shardingsphere-replication-of-database-and-table-shards",title:"shardingsphere\u5206\u5e93\u5206\u8868\u4e3b\u4ece\u590d\u5236",author:"Arce",author_title:"\u72ec\u7acb\u6e38\u620f\u5f00\u53d1\u8005",author_url:"https://github.com/charles0122",author_image_url:"https://avatars.githubusercontent.com/u/70085736?v=4",description:"\u6d4b\u8bd5",tags:["Java","SpringCloud","ShardingSphere"]},unlisted:!1,prevItem:{title:"\u672c\u5730\u865a\u62df\u673a\u914d\u7f6e\u5fae\u670d\u52a1\u73af\u5883docker\u7248",permalink:"/arcetop/blog/Configure-the-Docker-Edition-microservice-environment-for-the-local-VM"},nextItem:{title:"flutter getx \u591a\u8bed\u8a00 \u542b\u8ddf\u968f\u7cfb\u7edf\u4ee5\u53cafallback",permalink:"/arcetop/blog/flutter_getx_i18n_fallback_demo"}},t={authorsImageUrls:[void 0]},d=[{value:"1\u3001\u5b89\u88c5\u9700\u8981\u7684\u8f6f\u4ef6\u5305",id:"1\u5b89\u88c5\u9700\u8981\u7684\u8f6f\u4ef6\u5305",level:2},{value:"2\u3001\u8bbe\u7f6edocker\u4e0b\u8f7d\u955c\u50cf",id:"2\u8bbe\u7f6edocker\u4e0b\u8f7d\u955c\u50cf",level:2},{value:"3\u3001\u66f4\u65b0yum\u8f6f\u4ef6\u5305\u7d22\u5f15",id:"3\u66f4\u65b0yum\u8f6f\u4ef6\u5305\u7d22\u5f15",level:2},{value:"4\u3001\u5b89\u88c5docker ce",id:"4\u5b89\u88c5docker-ce",level:2},{value:"5\u3001\u542f\u52a8docker",id:"5\u542f\u52a8docker",level:2},{value:"6\u3001\u7248\u672c\u9a8c\u8bc1",id:"6\u7248\u672c\u9a8c\u8bc1",level:2},{value:"7\u3001\u8bbe\u7f6e\u5f00\u673a\u542f\u52a8",id:"7\u8bbe\u7f6e\u5f00\u673a\u542f\u52a8",level:2},{value:"\u4e8c\u4e3b\u4e8c\u4ece\u914d\u7f6e",id:"\u4e8c\u4e3b\u4e8c\u4ece\u914d\u7f6e",level:2}];function o(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",img:"img",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.admonition,{title:"\u6ce8\u610f",type:"caution",children:(0,l.jsx)(n.p,{children:"\u672c\u6587\u542b\u53cc\u4e3b\u4e92\u4ece\u3001\u53cc\u4e3b\u53cc\u4ece\u65b9\u5f0f \u914d\u7f6e\u9700\u8981\u5c06HOST\u6539\u6210\u4f60\u7684\u4e3b\u673aip POSSWORD \u6539\u6210\u4f60\u7684\u6570\u636e\u5e93\u5bc6\u7801"})}),"\n",(0,l.jsxs)(n.p,{children:["\u5b98\u7f51\uff1a",(0,l.jsx)(n.a,{href:"http://www.docker.com",children:"Docker\u5b98\u7f51"})]}),"\n",(0,l.jsxs)(n.p,{children:["\u5b89\u88c5\u624b\u518c\uff1a",(0,l.jsx)(n.a,{href:"https://docs.docker.com/install/linux/docker-ce/centos%EF%BC%88CE-%E7%A4%BE%E5%8C%BA%E7%89%88%EF%BC%89",children:"docker-ce \u793e\u533a\u7248"})]}),"\n",(0,l.jsx)(n.h2,{id:"1\u5b89\u88c5\u9700\u8981\u7684\u8f6f\u4ef6\u5305",children:"1\u3001\u5b89\u88c5\u9700\u8981\u7684\u8f6f\u4ef6\u5305"}),"\n",(0,l.jsx)(n.p,{children:"yy -utils\u63d0\u4f9b\u4e86yy-config-manager\u76f8\u5173\u529f\u80fd\uff0cdevice-mapper-persistent-data\u548clvm2\u662f\u8bbe\u5907\u6620\u5c04\u5668\u9a71\u52a8\u7a0b\u5e8f\u6240\u9700\u8981\u7684\u3002"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"yum install -y yum-utils \\\n               device-mapper-persistent-data \\\n               lvm2\n"})}),"\n",(0,l.jsx)(n.h2,{id:"2\u8bbe\u7f6edocker\u4e0b\u8f7d\u955c\u50cf",children:"2\u3001\u8bbe\u7f6edocker\u4e0b\u8f7d\u955c\u50cf"}),"\n",(0,l.jsx)(n.p,{children:"\u63a8\u8350\u963f\u91cc\u4e91\u4e0b\u8f7d\u5730\u5740"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\n"})}),"\n",(0,l.jsx)(n.h2,{id:"3\u66f4\u65b0yum\u8f6f\u4ef6\u5305\u7d22\u5f15",children:"3\u3001\u66f4\u65b0yum\u8f6f\u4ef6\u5305\u7d22\u5f15"}),"\n",(0,l.jsx)(n.p,{children:"\u6211\u4eec\u5728\u66f4\u65b0\u6216\u914d\u7f6eyum\u6e90\u4e4b\u540e\uff0c\u901a\u5e38\u90fd\u4f1a\u4f7f\u7528yum makecache \u751f\u6210\u7f13\u5b58\uff0c\u8fd9\u4e2a\u547d\u4ee4\u662f\u5c06\u8f6f\u4ef6\u5305\u4fe1\u606f\u63d0\u524d\u5728\u672c\u5730\u7f13\u5b58\u4e00\u4efd\uff0c\u7528\u6765\u63d0\u9ad8\u641c\u7d22\u5b89\u88c5\u8f6f\u4ef6\u7684\u901f\u5ea6"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"yum makecache fast\n"})}),"\n",(0,l.jsx)(n.h2,{id:"4\u5b89\u88c5docker-ce",children:"4\u3001\u5b89\u88c5docker ce"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"yum install -y docker-ce\n"})}),"\n",(0,l.jsx)(n.h2,{id:"5\u542f\u52a8docker",children:"5\u3001\u542f\u52a8docker"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"systemctl start docker\n\n"})}),"\n",(0,l.jsx)(n.h2,{id:"6\u7248\u672c\u9a8c\u8bc1",children:"6\u3001\u7248\u672c\u9a8c\u8bc1"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"docker version\n"})}),"\n",(0,l.jsx)(n.h2,{id:"7\u8bbe\u7f6e\u5f00\u673a\u542f\u52a8",children:"7\u3001\u8bbe\u7f6e\u5f00\u673a\u542f\u52a8"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"#\u67e5\u770b\u670d\u52a1\u662f\u5426\u81ea\u52a8\u542f\u52a8\uff08\u662f\uff1aenabled | \u5426\uff1adisabled\uff09\nsystemctl list-unit-files|grep docker.service\n\n#\u8bbe\u7f6e\u5f00\u673a\u542f\u52a8\uff1a\u5982\u4e0d\u662fenabled\u53ef\u4ee5\u8fd0\u884c\u5982\u4e0b\u547d\u4ee4\u8bbe\u7f6e\u81ea\u542f\u52a8\nsystemctl enable docker\n#\u91cd\u65b0\u52a0\u8f7d\u670d\u52a1\u914d\u7f6e\nsystemctl daemon-reload\n\n#\u5982\u679c\u5e0c\u671b\u4e0d\u8fdb\u884c\u81ea\u542f\u52a8\uff0c\u8fd0\u884c\u5982\u4e0b\u547d\u4ee4\u8bbe\u7f6e\nsystemctl disable docker\n#\u91cd\u65b0\u52a0\u8f7d\u670d\u52a1\u914d\u7f6e\nsystemctl daemon-reload\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u5378\u8f7d"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"systemctl stop docker\nyum remove -y docker-ce\nrm -rf /var/lib/docker\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u5f00\u5173\u9632\u706b\u5899"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"##\u5173\u95eddocker\nsystemctl stop docker\n##\u5173\u95ed\u9632\u706b\u5899\nsystemctl stop firewalld\n##\u542f\u52a8docker\nsystemctl start docker\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u4e8c\u4e3b\u4e8c\u4ece\u914d\u7f6e",children:"\u4e8c\u4e3b\u4e8c\u4ece\u914d\u7f6e"}),"\n",(0,l.jsx)(n.p,{children:"\u4e3b\u670d\u52a1\u5668 arce-mysql-master1 \u7aef\u53e3 3306"}),"\n",(0,l.jsx)(n.p,{children:"\u4e3b\u670d\u52a1\u5668 arce-mysql-master2 \u7aef\u53e3 3307"}),"\n",(0,l.jsx)(n.p,{children:"\u4ece\u670d\u52a1\u5668 arce-mysql-slave1 \u7aef\u53e3 13306"}),"\n",(0,l.jsx)(n.p,{children:"\u4ece\u670d\u52a1\u5668 arce-mysql-slave2 \u7aef\u53e3 13307"}),"\n",(0,l.jsx)(n.p,{children:"\u4e24\u4e2a\u4e3b\u670d\u52a1\u5668\u4e92\u4e3a\u4e3b\u4ece"}),"\n",(0,l.jsx)(n.p,{children:"\u51c6\u5907\u4e3b\u670d\u52a1\u5668"}),"\n",(0,l.jsx)(n.p,{children:"\u521b\u5efa\u672c\u673a\u6302\u8f7d\u76ee\u5f55"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"mkdir -p /usr/local/docker/arce-mysql-master1/data\nmkdir -p /usr/local/docker/arce-mysql-master1/mysql-files\nmkdir -p /usr/local/docker/arce-mysql-master1/cnf\nmkdir -p /usr/local/docker/arce-mysql-master1/log\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u542f\u52a8docker \u5bb9\u5668"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"docker run  \\\n--restart=always \\\n--name arce-mysql-master1 \\\n-v /usr/local/docker/arce-mysql-master1/cnf:/etc/mysql/conf.d \\\n-v /usr/local/docker/arce-mysql-master1/data:/var/lib/mysql \\\n-v /usr/local/docker/arce-mysql-master1/log:/var/log/mysql \\\n-v /usr/local/docker/arce-mysql-master1/mysql-files:/var/lib/mysql-files \\\n-p 3306:3306 \\\n-e MYSQL_ROOT_PASSWORD=PASSWORD \\\n-d mysql\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u7f16\u5199\u914d\u7f6e\u6587\u4ef6"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-she",children:"vim /usr/local/docker/arce-mysql-master1/cnf/my.cnf\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"#Apply this config only on the master.\n[client]\nport = 3306\ndefault-character-set = utf8mb4\n\n[mysql]\nport = 3306\ndefault-character-set = utf8mb4\n\n[mysqld]\n# bind-address = 0.0.0.0\n# port = 3306\n\nmax_connections=10000\n\ncharacter-set-server = utf8mb4\ncollation-server = utf8mb4_unicode_ci\n\n# \u8bbe\u7f6e\u65f6\u533a\u548c\u5b57\u7b26\u96c6\n# default-time-zone='+8:00'\ncharacter-set-client-handshake=FALSE\ninit_connect='SET NAMES utf8mb4 COLLATE utf8mb4_unicode_ci'\n\ngtid-mode=ON\nenforce-gtid-consistency = ON\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u8fdb\u5165\u5bb9\u5668bash"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"docker exec -it arce-mysql-master1 bash\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u6d4b\u8bd5\u8fdc\u7a0b\u8fde\u63a5"}),"\n",(0,l.jsx)(n.p,{children:"\u8fdb\u5165mysql"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"mysql -uroot -pPASSWORD\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u5c06root\u7528\u6237\u4ece\u53ea\u80fdlocalhost\u767b\u5f55\u6539\u4e3a % \u652f\u6301\u8fdc\u7a0b"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"update user set host='%' where user='root';\nFLUSH PRIVILEGES;\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u66f4\u6539\u5bc6\u7801\u63d2\u4ef6"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"##\u5982\u679cplugin \u7684\u52a0\u5bc6\u65b9\u5f0f\u4e3acaching_sha2_password\uff0c\u8868\u793a\u9700\u8981\u66f4\u6539\n##\u66f4\u6539root\u7528\u6237\u52a0\u5bc6\u65b9\u5f0f\nALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password by 'PASSWORD';\nALTER USER 'root'@'%' IDENTIFIED WITH mysql_native_password BY 'PASSWORD';\nFLUSH PRIVILEGES;\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u67e5\u770b\u6743\u9650\u4fe1\u606f"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"use mysql;\nselect host, user, authentication_string, plugin from user;\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{alt:"image-20230408094519538",src:s(98902).A+"",width:"1464",height:"224"})}),"\n",(0,l.jsx)(n.p,{children:"\u51c6\u5907\u4e3b\u670d\u52a1\u56682"}),"\n",(0,l.jsx)(n.p,{children:"\u521b\u5efa\u672c\u673a\u6302\u8f7d\u76ee\u5f55"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"mkdir -p /usr/local/docker/arce-mysql-master2/data\nmkdir -p /usr/local/docker/arce-mysql-master2/mysql-files\nmkdir -p /usr/local/docker/arce-mysql-master2/cnf\nmkdir -p /usr/local/docker/arce-mysql-master2/log\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u542f\u52a8docker \u5bb9\u5668"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"docker run  \\\n--restart=always \\\n--name arce-mysql-master2 \\\n-v /usr/local/docker/arce-mysql-master2/cnf:/etc/mysql/conf.d \\\n-v /usr/local/docker/arce-mysql-master2/data:/var/lib/mysql \\\n-v /usr/local/docker/arce-mysql-master2/log:/var/log/mysql \\\n-v /usr/local/docker/arce-mysql-master2/mysql-files:/var/lib/mysql-files \\\n-p 3307:3306 \\\n-e MYSQL_ROOT_PASSWORD=PASSWORD \\\n-d mysql\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u7f16\u5199\u914d\u7f6e\u6587\u4ef6"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"vim /usr/local/docker/arce-mysql-master2/cnf/my.cnf\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"#Apply this config only on the master.\n[client]\nport = 3306\ndefault-character-set = utf8mb4\n\n[mysql]\nport = 3306\ndefault-character-set = utf8mb4\n\n\n[mysqld]\n#skip-grant-tables\n## \u670d\u52a1\u5668\u552f\u4e00id\uff0c\u9ed8\u8ba4\u503c1\nserver-id=2000\n## \u8bbe\u7f6e\u65e5\u5fd7\u683c\u5f0f\uff0c\u9ed8\u8ba4\u503cROW\nbinlog_format=STATEMENT\n## \u4e8c\u8fdb\u5236\u65e5\u5fd7\u540d\uff0c\u9ed8\u8ba4binlog\n## log-bin=binlog\n## \u8bbe\u7f6e\u9700\u8981\u590d\u5236\u7684\u6570\u636e\u5e93\uff0c\u9ed8\u8ba4\u590d\u5236\u5168\u90e8\u6570\u636e\u5e93\n##binlog-do-db=mytestdb\n## \u8bbe\u7f6e\u4e0d\u9700\u8981\u590d\u5236\u7684\u6570\u636e\u5e93\n##binlog-ignore-db=mysql\n##binlog-ignore-db=infomation_schema\n# bind-address = 0.0.0.0\n# port = 3306\n\nmax_connections=10000\n\ncharacter-set-server = utf8mb4\ncollation-server = utf8mb4_unicode_ci\n\n# \u8bbe\u7f6e\u65f6\u533a\u548c\u5b57\u7b26\u96c6\ndefault-time-zone='+8:00'\ncharacter-set-client-handshake=FALSE\ninit_connect='SET NAMES utf8mb4 COLLATE utf8mb4_unicode_ci'\n\ngtid-mode=ON\nenforce-gtid-consistency = ON\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u8fdb\u5165\u5bb9\u5668bash"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"docker exec -it arce-mysql-master2 bash\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u8bbe\u7f6e\u53cc\u4e3b\u4e92\u4ece"}),"\n",(0,l.jsx)(n.p,{children:"\u4e3b1"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"#Apply this config only on the master.\n[client]\nport = 3306\ndefault-character-set = utf8mb4\n\n[mysql]\n# bind-address = 0.0.0.0\nport = 3306\ndefault-character-set = utf8mb4\n\n\n[mysqld]\n#skip-grant-tables\n## \u670d\u52a1\u5668\u552f\u4e00id\uff0c\u9ed8\u8ba4\u503c1\nserver-id=1000\n## \u8bbe\u7f6e\u65e5\u5fd7\u683c\u5f0f\uff0c\u9ed8\u8ba4\u503cROW\nbinlog_format=STATEMENT\n#\u5f00\u542f\u53ca\u8bbe\u7f6e\u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6\u540d\u79f0\nlog_bin = mysql-bin\nbinlog_format = MIXED\nsync_binlog = 1\n#\u4e8c\u8fdb\u5236\u65e5\u5fd7\u81ea\u52a8\u5220\u9664/\u8fc7\u671f\u7684\u5929\u6570\u3002\u9ed8\u8ba4\u503c\u4e3a0\uff0c\u8868\u793a\u4e0d\u81ea\u52a8\u5220\u9664\u3002\nexpire_logs_days =7\n\n## \u8bbe\u7f6e\u9700\u8981\u590d\u5236\u7684\u6570\u636e\u5e93\uff0c\u9ed8\u8ba4\u590d\u5236\u5168\u90e8\u6570\u636e\u5e93\n##binlog-do-db=mytestdb\n# \u4e0d\u9700\u8981\u540c\u6b65\u7684\u6570\u636e\u5e93\nbinlog-ignore-db = mysql\nbinlog_ignore_db = information_schema\nbinlog_ignore_db = performation_schema\nbinlog_ignore_db = sys\n\n\nmax_connections=10000\n\ncharacter-set-server = utf8mb4\ncollation-server = utf8mb4_unicode_ci\n\n# \u8bbe\u7f6e\u65f6\u533a\u548c\u5b57\u7b26\u96c6\ndefault-time-zone='+8:00'\ncharacter-set-client-handshake=FALSE\ninit_connect='SET NAMES utf8mb4 COLLATE utf8mb4_unicode_ci'\n\ngtid-mode=ON\nenforce-gtid-consistency = ON\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u4e3b2"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"#Apply this config only on the master.\n[client]\nport = 3306\ndefault-character-set = utf8mb4\n\n[mysql]\nport = 3306\ndefault-character-set = utf8mb4\n# bind-address = 0.0.0.0\n# port = 3306\n\n[mysqld]\n#skip-grant-tables\n## \u670d\u52a1\u5668\u552f\u4e00id\uff0c\u9ed8\u8ba4\u503c1\nserver-id=2000\n## \u8bbe\u7f6e\u65e5\u5fd7\u683c\u5f0f\uff0c\u9ed8\u8ba4\u503cROW\nbinlog_format=STATEMENT\n#\u5f00\u542f\u53ca\u8bbe\u7f6e\u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6\u540d\u79f0\nlog_bin = mysql-bin\nbinlog_format = MIXED\nsync_binlog = 1\n#\u4e8c\u8fdb\u5236\u65e5\u5fd7\u81ea\u52a8\u5220\u9664/\u8fc7\u671f\u7684\u5929\u6570\u3002\u9ed8\u8ba4\u503c\u4e3a0\uff0c\u8868\u793a\u4e0d\u81ea\u52a8\u5220\u9664\u3002\nexpire_logs_days =7\n## \u8bbe\u7f6e\u9700\u8981\u590d\u5236\u7684\u6570\u636e\u5e93\uff0c\u9ed8\u8ba4\u590d\u5236\u5168\u90e8\u6570\u636e\u5e93\n##binlog-do-db=mytestdb\n## \u8bbe\u7f6e\u4e0d\u9700\u8981\u590d\u5236\u7684\u6570\u636e\u5e93\nbinlog-ignore-db = mysql\nbinlog_ignore_db = information_schema\nbinlog_ignore_db = performation_schema\nbinlog_ignore_db = sys\n\n\nmax_connections=10000\n\ncharacter-set-server = utf8mb4\ncollation-server = utf8mb4_unicode_ci\n\n# \u8bbe\u7f6e\u65f6\u533a\u548c\u5b57\u7b26\u96c6\ndefault-time-zone='+8:00'\ncharacter-set-client-handshake=FALSE\ninit_connect='SET NAMES utf8mb4 COLLATE utf8mb4_unicode_ci'\n\ngtid-mode=ON\nenforce-gtid-consistency = ON\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u91cd\u542f\u4e24\u4e2a\u4e3b\u670d\u52a1\u5668"}),"\n",(0,l.jsx)(n.p,{children:"\u8fdb\u884c\u4e3b1 bash"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"docker exec -it arce-mysql-master1 bash\nmysql -uroot -p\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u521b\u5efaslave\u7528\u6237\u5e76\u6388\u6743,\u4e24\u4e2amaster\u8282\u70b9\u90fd\u521b\u5efa"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"#\u521b\u5efa\u7528\u6237\nALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password by 'PASSWORD';\nALTER USER 'root'@'%' IDENTIFIED WITH mysql_native_password BY 'PASSWORD';\nCREATE USER 'slave'@'%' IDENTIFIED WITH mysql_native_password BY 'PASSWORD';\n#\u5206\u914d\u6743\u9650\nGRANT REPLICATION SLAVE ON *.* TO 'slave'@'%';\n#\u5237\u65b0\u6743\u9650\nflush privileges;\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u67e5\u770bmaster\u72b6\u6001\uff1a",(0,l.jsx)(n.code,{children:"SHOW MASTER STATUS"}),"\uff0c\u8bb0\u5f55\u4e8c\u8fdb\u5236\u6587\u4ef6\u540d(mysql-bin.000001)\u548c\u4f4d\u7f6e(821)"]}),"\n",(0,l.jsx)(n.p,{children:"master1"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{alt:"image-20230408110257788",src:s(96251).A+"",width:"1599",height:"377"})}),"\n",(0,l.jsx)(n.p,{children:"master2"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{alt:"image-20230408110622010",src:s(89807).A+"",width:"1571",height:"376"})}),"\n",(0,l.jsx)(n.p,{children:"\u8bbe\u7f6e\u8fde\u63a5"}),"\n",(0,l.jsx)(n.p,{children:"master1\u8fde\u63a5master2"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"CHANGE MASTER TO\nMASTER_HOST='HOST',\nMASTER_USER='slave',\nMASTER_PASSWORD='PASSWORD',\nMASTER_PORT=3307,\nMASTER_LOG_FILE='mysql-bin.000001',\nMASTER_LOG_POS=821;\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{alt:"image-20230408111131360",src:s(69937).A+"",width:"616",height:"200"})}),"\n",(0,l.jsx)(n.p,{children:"master2\u8fde\u63a5master1"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"CHANGE MASTER TO\nMASTER_HOST='HOST',\nMASTER_USER='slave',\nMASTER_PASSWORD='PASSWORD',\nMASTER_PORT=3306,\nMASTER_LOG_FILE='mysql-bin.000001',\nMASTER_LOG_POS=821;\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{alt:"image-20230408111116887",src:s(11484).A+"",width:"628",height:"215"})}),"\n",(0,l.jsx)(n.p,{children:"\u542f\u52a8 slave \u8fdb\u7a0b"}),"\n",(0,l.jsx)(n.p,{children:"master1"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{alt:"image-20230408111300490",src:s(22977).A+"",width:"983",height:"1330"})}),"\n",(0,l.jsx)(n.p,{children:"master2"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{alt:"image-20230408111346417",src:s(13496).A+"",width:"999",height:"1208"})}),"\n",(0,l.jsx)(n.p,{children:"\u4e8c\u4e3b\u4e8c\u4ece\uff0c\u4e00\u4e3b\u4e00\u4e1b"}),"\n",(0,l.jsx)(n.p,{children:"\u6ce8\u610f\u9700\u53d6\u6d88\u4e4b\u524d\u7684\u53cc\u4e3b\u4e92\u4ece"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"docker exec -it arce-mysql-master1 bash\ndocker exec -it arce-mysql-master2 bash\nmysql -u root -p\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"stop slave;\n"})}),"\n",(0,l.jsx)(n.p,{children:"slave1"}),"\n",(0,l.jsx)(n.p,{children:"\u521b\u5efa\u672c\u673a\u6302\u8f7d\u76ee\u5f55"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"mkdir -p /usr/local/docker/arce-mysql-slave1/data\nmkdir -p /usr/local/docker/arce-mysql-slave1/mysql-files\nmkdir -p /usr/local/docker/arce-mysql-slave1/cnf\nmkdir -p /usr/local/docker/arce-mysql-slave1/log\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u542f\u52a8docker \u5bb9\u5668"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"docker run  \\\n--restart=always \\\n--name arce-mysql-slave1 \\\n-v /usr/local/docker/arce-mysql-slave1/cnf:/etc/mysql/conf.d \\\n-v /usr/local/docker/arce-mysql-slave1/data:/var/lib/mysql \\\n-v /usr/local/docker/arce-mysql-slave1/log:/var/log/mysql \\\n-v /usr/local/docker/arce-mysql-slave1/mysql-files:/var/lib/mysql-files \\\n-p 13306:3306 \\\n-e MYSQL_ROOT_PASSWORD=PASSWORD \\\n-d mysql\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u7f16\u5199\u914d\u7f6e\u6587\u4ef6"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-she",children:"vim /usr/local/docker/arce-mysql-slave1/cnf/my.cnf\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"#Apply this config only on the master.\n[client]\nport = 3306\ndefault-character-set = utf8mb4\n\n[mysql]\nport = 3306\ndefault-character-set = utf8mb4\n\n\n[mysqld]\n#skip-grant-tables\n## \u670d\u52a1\u5668\u552f\u4e00id\uff0c\u9ed8\u8ba4\u503c1\nserver-id=1001\n## \u8bbe\u7f6e\u65e5\u5fd7\u683c\u5f0f\uff0c\u9ed8\u8ba4\u503cROW\nbinlog_format=STATEMENT\n## \u4e8c\u8fdb\u5236\u65e5\u5fd7\u540d\uff0c\u9ed8\u8ba4binlog\n## log-bin=binlog\n## \u8bbe\u7f6e\u9700\u8981\u590d\u5236\u7684\u6570\u636e\u5e93\uff0c\u9ed8\u8ba4\u590d\u5236\u5168\u90e8\u6570\u636e\u5e93\n##binlog-do-db=mytestdb\n## \u8bbe\u7f6e\u4e0d\u9700\u8981\u590d\u5236\u7684\u6570\u636e\u5e93\n##binlog-ignore-db=mysql\n##binlog-ignore-db=infomation_schema\n# bind-address = 0.0.0.0\n# port = 3306\n\nmax_connections=10000\n\ncharacter-set-server = utf8mb4\ncollation-server = utf8mb4_unicode_ci\n\n# \u8bbe\u7f6e\u65f6\u533a\u548c\u5b57\u7b26\u96c6\ndefault-time-zone='+8:00'\ncharacter-set-client-handshake=FALSE\ninit_connect='SET NAMES utf8mb4 COLLATE utf8mb4_unicode_ci'\n\ngtid-mode=ON\nenforce-gtid-consistency = ON\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u8fdb\u5165\u5bb9\u5668bash"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"docker exec -it arce-mysql-slave1 bash\n"})}),"\n",(0,l.jsx)(n.p,{children:"salve1 \u8fde\u63a5 master1"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"CHANGE MASTER TO\nMASTER_HOST='HOST',\nMASTER_USER='slave',\nMASTER_PASSWORD='PASSWORD',\nMASTER_PORT=3306,\nMASTER_LOG_FILE='mysql-bin.000001',\nMASTER_LOG_POS=821;\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:" start slave;\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"show slave status\\G;\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{alt:"image-20230408220152389",src:s(28170).A+"",width:"858",height:"847"})}),"\n",(0,l.jsx)(n.p,{children:"slave2 \u91cd\u590dslave1"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{alt:"image-20230408220937264",src:s(7857).A+"",width:"819",height:"648"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{alt:"image-20230408221205061",src:s(45731).A+"",width:"357",height:"117"})})]})}function m(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(o,{...e})}):o(e)}},98902:(e,n,s)=>{s.d(n,{A:()=>l});const l=s.p+"assets/images/image-20230408094519538-1c26b4fa2602ac0bdd2d0753c15850f5.png"},96251:(e,n,s)=>{s.d(n,{A:()=>l});const l=s.p+"assets/images/image-20230408110257788-8cd00508a18090a95a4f0628dd856f31.png"},89807:(e,n,s)=>{s.d(n,{A:()=>l});const l=s.p+"assets/images/image-20230408110622010-e4339ea918786443c2ea9d49780f484d.png"},11484:(e,n,s)=>{s.d(n,{A:()=>l});const l=s.p+"assets/images/image-20230408111116887-11088276b743afb06a4bbb327f281d64.png"},69937:(e,n,s)=>{s.d(n,{A:()=>l});const l=s.p+"assets/images/image-20230408111131360-c7e6236659c0c1aca2c3ac9fabf9c18c.png"},22977:(e,n,s)=>{s.d(n,{A:()=>l});const l=s.p+"assets/images/image-20230408111300490-2268c103967da54879b7930aeb977382.png"},13496:(e,n,s)=>{s.d(n,{A:()=>l});const l=s.p+"assets/images/image-20230408111346417-56181d4c45633b6a00f6646f62a8b4e0.png"},28170:(e,n,s)=>{s.d(n,{A:()=>l});const l=s.p+"assets/images/image-20230408220152389-d0c808d4afc891bb0d6f083600519806.png"},7857:(e,n,s)=>{s.d(n,{A:()=>l});const l=s.p+"assets/images/image-20230408220937264-4eef5b9428d2b63459db9e005c32c953.png"},45731:(e,n,s)=>{s.d(n,{A:()=>l});const l=s.p+"assets/images/image-20230408221205061-4bd633d8612b05126e8dd736da534de8.png"},99128:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>i});var l=s(79474);const r={},a=l.createContext(r);function c(e){const n=l.useContext(a);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),l.createElement(a.Provider,{value:n},e.children)}}}]);