"use strict";(self.webpackChunkarce_top=self.webpackChunkarce_top||[]).push([[4573],{88494:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>s,contentTitle:()=>l,default:()=>c,frontMatter:()=>a,metadata:()=>i,toc:()=>m});var n=t(13274),o=t(99128);const a={slug:"flutter_getx_theme_demo",title:"flutter getx \u591a\u4e3b\u9898 \u5305\u542b\u6df1\u8272\u6a21\u5f0f",author:"Arce",author_title:"\u72ec\u7acb\u6e38\u620f\u5f00\u53d1\u8005",author_url:"https://github.com/charles0122",author_image_url:"https://avatars.githubusercontent.com/u/70085736?v=4",description:"flutter getx \u591a\u4e3b\u9898 \u5305\u542b\u6df1\u8272\u6a21\u5f0f",tags:["Dart","Flutter","Getx","Theme"]},l=void 0,i={permalink:"/arcetop/blog/flutter_getx_theme_demo",editUrl:"https://github.com/charles0122/arce.top/edit/main/arce.top/blog/2023-04-02-flutter_getx_theme_demo.md",source:"@site/blog/2023-04-02-flutter_getx_theme_demo.md",title:"flutter getx \u591a\u4e3b\u9898 \u5305\u542b\u6df1\u8272\u6a21\u5f0f",description:"flutter getx \u591a\u4e3b\u9898 \u5305\u542b\u6df1\u8272\u6a21\u5f0f",date:"2023-04-02T00:00:00.000Z",tags:[{label:"Dart",permalink:"/arcetop/blog/tags/dart"},{label:"Flutter",permalink:"/arcetop/blog/tags/flutter"},{label:"Getx",permalink:"/arcetop/blog/tags/getx"},{label:"Theme",permalink:"/arcetop/blog/tags/theme"}],readingTime:5.16,hasTruncateMarker:!0,authors:[{name:"Arce",title:"\u72ec\u7acb\u6e38\u620f\u5f00\u53d1\u8005",url:"https://github.com/charles0122",imageURL:"https://avatars.githubusercontent.com/u/70085736?v=4"}],frontMatter:{slug:"flutter_getx_theme_demo",title:"flutter getx \u591a\u4e3b\u9898 \u5305\u542b\u6df1\u8272\u6a21\u5f0f",author:"Arce",author_title:"\u72ec\u7acb\u6e38\u620f\u5f00\u53d1\u8005",author_url:"https://github.com/charles0122",author_image_url:"https://avatars.githubusercontent.com/u/70085736?v=4",description:"flutter getx \u591a\u4e3b\u9898 \u5305\u542b\u6df1\u8272\u6a21\u5f0f",tags:["Dart","Flutter","Getx","Theme"]},unlisted:!1,prevItem:{title:"flutter getx \u591a\u8bed\u8a00 \u542b\u8ddf\u968f\u7cfb\u7edf\u4ee5\u53cafallback",permalink:"/arcetop/blog/flutter_getx_i18n_fallback_demo"},nextItem:{title:"\u4f7f\u7528A\u5361\u5728Linuxx\u865a\u62df\u673a\u73a9StableDiffusion",permalink:"/arcetop/blog/linux-amd-stable-diffusion-novel-ai"}},s={authorsImageUrls:[void 0]},m=[{value:"\u539f\u7406\u5206\u6790",id:"\u539f\u7406\u5206\u6790",level:2},{value:"\u6848\u4f8b\u4ee3\u7801",id:"\u6848\u4f8b\u4ee3\u7801",level:2}];function h(e){const r={a:"a",admonition:"admonition",code:"code",h2:"h2",img:"img",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{style:{textAlign:"center"},children:(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{alt:"flutter_theme_getx",src:t(25782).A+"#pic_center",width:"300",height:"621"})})}),"\n",(0,n.jsx)(r.p,{children:"\u601d\u8def\uff1a\u4f7f\u7528Getx\u7684 changeThemeMode /  forceAppUpdate  \u548c \u7f13\u5b58"}),"\n",(0,n.jsxs)(r.admonition,{title:"\u6ce8\u610f",type:"caution",children:[(0,n.jsx)(r.p,{children:"\u754c\u9762\u4ee3\u7801\u53c2\u8003\u5176\u4ed6\u535a\u5ba2\u548c\u9879\u76ee"}),(0,n.jsx)(r.p,{children:(0,n.jsx)(r.a,{href:"https://gitee.com/sunyongsheng/Allpass?_from=gitee_search",children:"Allpass: Allpass\u662f\u4e00\u6b3e\u7b80\u6d01\u7684\u79c1\u5bc6\u4fe1\u606f\u7ba1\u7406\u5de5\u5177\uff0c\u5305\u62ec\u5bc6\u7801\u7ba1\u7406\u4e0e\u5361\u7247\u4fe1\u606f\u7ba1\u7406\uff0c\u652f\u6301\u6307\u7eb9\u89e3\u9501\u8f6f\u4ef6\u3001csv\u5bfc\u5165\u5bfc\u51fa\u3001\u4eceChrome\u4e2d\u5bfc\u5165\u3001\u4ece\u526a\u8d34\u677f\u4e2d\u5bfc\u5165\u3001\u6587\u4ef6\u5939\u4e0e\u6807\u7b7e\u529f\u80fd\u3001\u6536\u85cf\u4e0e\u5907\u6ce8\u529f\u80fd\u3001\u5bc6\u7801\u751f\u6210\u5668\u3001WebDAV\u540c\u6b65\u7b49\u529f\u80fd\uff0c\u91c7\u7528Flutter\u6784\u5efa (gitee.com)"})}),(0,n.jsx)(r.p,{children:(0,n.jsx)(r.a,{href:"https://juejin.cn/post/6861889467188412423",children:"Flutter\u4e3b\u9898\u9002\u914d\u4e0e\u81ea\u52a8\u5207\u6362\u6697\u8272\u6a21\u5f0f - \u6398\u91d1 (juejin.cn)"})}),(0,n.jsx)(r.p,{children:(0,n.jsx)(r.a,{href:"https://www.jianshu.com/p/5b750b05b441",children:"Flutter \u591a\u8bed\u8a00&\u591a\u4e3b\u9898\u5b9e\u73b0 - \u7b80\u4e66 (jianshu.com)"})})]}),"\n",(0,n.jsx)(r.h2,{id:"\u539f\u7406\u5206\u6790",children:"\u539f\u7406\u5206\u6790"}),"\n",(0,n.jsx)(r.p,{children:"\u83b7\u53d6\u7f13\u5b58\u4e2d\u7684 \u4e3b\u9898\u6a21\u5f0fSTORAGE_THEME_MODE  \u4e3b\u9898\u8272 STORAGE_THEME_COLOR \u5728 ThemeStore\u7684\u521d\u59cb\u5316\u8fdb\u884c\u8d4b\u503c \u7136\u540e\u5728 ThemeService \u521d\u59cb\u5316\u7684\u65f6\u5019\u53bb\u8f6c\u5316\u518d\u8d4b\u503c  \u5f53\u7136\u4e5f\u53ef\u4ee5\u51cf\u5c11ThemeService \u5c42\u7684\u64cd\u4f5c \u76f4\u63a5\u4eceThemeStore \u5c42\u8fdb\u884c"}),"\n",(0,n.jsx)(r.h2,{id:"\u6848\u4f8b\u4ee3\u7801",children:"\u6848\u4f8b\u4ee3\u7801"}),"\n",(0,n.jsx)(r.p,{children:"GetMaterialApp"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-dart",children:'GetMaterialApp(\n    title: "Arce App",\n    // ... \u5176\u5b83\u914d\u7f6e\n    theme: ThemeService.to.lightTheme,\n    darkTheme: ThemeService.to.darkTheme,\n    themeMode: ThemeService.to.themeMode,\n    // ...\n);\n'})}),"\n",(0,n.jsx)(r.p,{children:"\u6838\u5fc3\u4ee3\u7801\u6587\u4ef6 ThemeStore"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-dart",children:'class ThemeStore extends GetxController {\n  static ThemeStore get to => Get.find();\n  final _themeMode = ThemeMode.light.obs;\n  final _primaryColor = PrimaryColor.blue.obs;\n\n  @override\n  void onInit() {\n    super.onInit();\n    _themeMode.value = ThemeModes.tryParse(StorageService.to.getString(STORAGE_THEME_MODE)) ?? ThemeMode.light;\n    _primaryColor.value = PrimaryColors.tryParse(StorageService.to.getString(STORAGE_THEME_COLOR)) ?? PrimaryColor.blue;\n    print("\u521d\u59cb\u5316\u4e3b\u9898\u548c\u989c\u8272${StorageService.to.getString(STORAGE_THEME_MODE)} , ${StorageService.to.getString(STORAGE_THEME_COLOR)}");\n  }\n\n  ThemeMode getThemeMode(){\n    return _themeMode.value;\n  }\n\n  PrimaryColor getPrimaryColor(){\n    return _primaryColor.value;\n  }\n\n  // \u83b7\u53d6token\n  Future<void> setThemeMode(ThemeMode value) async{\n    await StorageService.to.setString(STORAGE_THEME_MODE,value.name);\n    print("_themeMode "+ value.toString());\n    _themeMode.value = value;\n  }\n\n\n  Future<void> setPrimaryColor(PrimaryColor value) async{\n    await StorageService.to.setString(STORAGE_THEME_COLOR,value.name);\n\n    print("_primaryColor "+ value.toString());\n    _primaryColor.value = value;\n  }\n}\n'})}),"\n",(0,n.jsx)(r.p,{children:"\u6838\u5fc3\u4ee3\u7801\u6587\u4ef6 ThemeService"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-dart",children:'class ThemeService extends GetxService {\n  static ThemeService get to => Get.find();\n\n  Future<ThemeService> init() async {\n    _allTheme = ArceAllTheme();\n    primaryColor = ThemeStore.to.getPrimaryColor();\n    lightTheme = _convertTheme(primaryColor, false);\n    darkTheme = _convertTheme(primaryColor, true);\n    themeMode = ThemeStore.to.getThemeMode();\n    return this;\n  }\n\n  late ThemeMode themeMode; // \u6d45\u8272 / \u6df1\u8272 / \u8ddf\u968f\u7cfb\u7edf\n  late ThemeData lightTheme; // \u6d45\u8272\u6a21\u5f0f\u4e0b\u7684\u4e3b\u9898\n  late ThemeData darkTheme; // \u6697\u8272\u6a21\u5f0f\u4e0b\u7684\u4e3b\u9898\n  late ArceAllTheme _allTheme; // \u4e3b\u9898\u6a21\u5f0f\n  late PrimaryColor primaryColor;\n\n  /// \u7279\u6b8a\u7684\u80cc\u666f\u989c\u8272\n  /// \u5c11\u90e8\u5206\u9875\u9762\u80cc\u666f\u989c\u8272\u4e3a\u6d45\u767d\u8272\n  late Color specialBackgroundColor;\n  late Color offstageColor;\n\n  Future<void> changeThemeMode(ThemeMode targetMode, Brightness platformBrightness) async {\n    await ThemeStore.to.setThemeMode(targetMode);\n    themeMode = targetMode;\n    setExtraColor(platformBrightness);\n  }\n\n  Future<void> changePrimaryColor(PrimaryColor color, Brightness platformBrightness) async {\n    primaryColor = color;\n    await ThemeStore.to.setPrimaryColor(color);\n    lightTheme = _convertTheme(color, false);\n    darkTheme = _convertTheme(color, true);\n    setExtraColor(platformBrightness);\n  }\n\n  ThemeData _convertTheme(PrimaryColor color, bool dark) {\n    switch (color) {\n      case PrimaryColor.blue:\n        return _allTheme.blueTheme(dark);\n      default:\n        return _allTheme.blueTheme(dark);\n    }\n  }\n\n  void setExtraColor(Brightness platformBrightness) {\n    if (themeMode == ThemeMode.system) {\n      _setExtraColorAuto(platformBrightness);\n    } else if (themeMode == ThemeMode.dark) {\n      _setExtraColorDarkMode();\n    } else {\n      _setExtraColorLightMode();\n    }\n    // notifyListeners();\n    // Get.changeTheme( lightTheme);\n\n    print("\u4e3b\u9898\u4e3a\u4fee\u6539 "+ themeMode.toString());\n    // (()async{Get.changeThemeMode(themeMode);})();  // \u597d\u50cf\u6709\u5f02\u6b65\u95ee\u9898 \u6570\u636e\u66f4\u65b0\u4e86\uff0c\u4f46\u662fui\u5c42\u672a\u66f4\u65b0\n    // \u5f3a\u5236build\n    Get.forceAppUpdate();\n  }\n\n  void _setExtraColorLightMode() {\n    specialBackgroundColor = Color.fromRGBO(245, 246, 250, 1);\n    offstageColor = Colors.black87;\n  }\n\n  void _setExtraColorDarkMode() {\n    specialBackgroundColor = Colors.black;\n    offstageColor = Colors.grey[600]!;\n  }\n\n  void _setExtraColorAuto(Brightness platformBrightness) {\n    if (platformBrightness == Brightness.dark) {\n      _setExtraColorDarkMode();\n    } else {\n      _setExtraColorLightMode();\n    }\n  }\n}\n'})}),"\n",(0,n.jsx)(r.p,{children:"ArceAllTheme\u6587\u4ef6\u5b58\u653e\u4e2d \u4e3b\u9898\u6570\u636e"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-dart",children:"/// \u4e3b\u9898\nclass ArceAllTheme {\n    /// ... \u5176\u4ed6\u4e3b\u9898\n    /// \u9ed8\u8ba4\u4e3b\u9898\n ThemeData defaultTheme({required MaterialColor mainColor}) {\n        return ThemeData(\n          primaryColor: mainColor,\n          primarySwatch: mainColor,\n          floatingActionButtonTheme: const FloatingActionButtonThemeData(\n            foregroundColor: Colors.white,\n          ),\n          appBarTheme: const AppBarTheme(\n            systemOverlayStyle: SystemUiOverlayStyle.dark,\n            iconTheme: IconThemeData(color: Colors.black),\n            elevation: 0,\n            color: Colors.white,\n            titleTextStyle: TextStyle(color: Colors.black),\n          ),\n          bottomNavigationBarTheme: BottomNavigationBarThemeData(\n            elevation: 0,\n            selectedItemColor: mainColor,\n            backgroundColor: Colors.white,\n            unselectedItemColor: Colors.grey,\n          ),\n          scaffoldBackgroundColor: Colors.white,\n          buttonTheme: const ButtonThemeData(\n            shape: RoundedRectangleBorder(\n              borderRadius: BorderRadius.all(Radius.circular(8.0)),\n            ),\n          ),\n          textButtonTheme: TextButtonThemeData(\n            style: ButtonStyle(\n              foregroundColor: MaterialStateProperty.all(Colors.black),\n              backgroundColor: MaterialStateProperty.all(Colors.transparent),\n              alignment: Alignment.center,\n              shape: MaterialStateProperty.all(\n                const RoundedRectangleBorder(\n                  borderRadius: BorderRadius.all(Radius.circular(8.0)),\n                ),\n              ),\n            ),\n          ),\n          indicatorColor: mainColor,\n          textSelectionTheme: TextSelectionThemeData(cursorColor: mainColor),\n          cardTheme: const CardTheme(\n            color: Colors.white,\n            shape: RoundedRectangleBorder(\n              borderRadius: BorderRadius.all(Radius.circular(8.0)),\n            ),\n            elevation: 0,\n            clipBehavior: Clip.antiAlias,\n          ),\n          inputDecorationTheme: const InputDecorationTheme(\n            fillColor: Color.fromRGBO(245, 246, 250, 1),\n            border: OutlineInputBorder(\n              borderRadius: BorderRadius.all(Radius.circular(8.0)),\n              borderSide: BorderSide.none,\n            ),\n          ),\n          dialogTheme: const DialogTheme(\n            shape: RoundedRectangleBorder(\n              borderRadius: BorderRadius.all(Radius.circular(8.0)),\n            ),\n          ),\n          bottomSheetTheme: const BottomSheetThemeData(\n            shape: RoundedRectangleBorder(\n              borderRadius: BorderRadius.only(\n                  topLeft: Radius.circular(8.0), topRight: Radius.circular(8.0)),\n            ),\n          ),\n          popupMenuTheme: const PopupMenuThemeData(\n            shape: RoundedRectangleBorder(\n              borderRadius: BorderRadius.all(Radius.circular(8.0)),\n            ),\n          ),\n          listTileTheme: const ListTileThemeData(minLeadingWidth: 32),\n        );\n      }\n}\n"})}),"\n",(0,n.jsx)(r.p,{children:"\u4e3b\u9898\u6a21\u5f0f ThemeMode\u76f8\u5173"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-dart",children:'class ThemeModes {\n  static ThemeMode? tryParse(String? name) {\n    if (name == ThemeMode.light.name) {\n      return ThemeMode.light;\n    } else if (name == ThemeMode.dark.name) {\n      return ThemeMode.dark;\n    } else if (name == ThemeMode.system.name) {\n      return ThemeMode.system;\n    }\n    return null;\n  }\n}\n\nclass ThemeModeItem {\n  final ThemeMode mode;\n  final String desc;\n\n  const ThemeModeItem(this.mode, this.desc);\n}\n\nvar themeModes = [\n  const ThemeModeItem(ThemeMode.system, "\u8ddf\u968f\u7cfb\u7edf"),\n  const ThemeModeItem(ThemeMode.light, "\u6d45\u8272"),\n  const ThemeModeItem(ThemeMode.dark, "\u6df1\u8272")\n];\n'})}),"\n",(0,n.jsx)(r.p,{children:"\u4e3b\u9898\u8272  PrimaryColor \u76f8\u5173"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-dart",children:'\nenum PrimaryColor { blue, blueGrey }\n\nclass PrimaryColors {\n  static PrimaryColor? tryParse(String? name) {\n    for (var color in PrimaryColor.values) {\n      if (color.name == name) {\n        return color;\n      }\n    }\n    return null;\n  }\n}\n\nclass PrimaryColorItem {\n  final PrimaryColor primaryColor;\n  final String desc;\n  final Color color;\n  const PrimaryColorItem(this.primaryColor, this.desc, this.color);\n}\n\nvar primaryColors = [\n  const PrimaryColorItem(PrimaryColor.blue, "\u84dd\u8272", Colors.blue),\n  const PrimaryColorItem(PrimaryColor.blueGrey, "\u84dd\u7070", Colors.blueGrey),\n];\n\n'})}),"\n",(0,n.jsx)(r.p,{children:"\u603b\u7ed3\uff1aGet\u4e2d\u597d\u50cf\u53ea\u6709 changeThemeMode \u7684\u65b9\u6cd5 \u6240\u4ee5\u6709\u4e00\u4e2a\u4e0d\u597d\u7684\u5730\u65b9\u662f\u5207\u6362\u4e3b\u9898\u989c\u8272\u540e\u9700\u8981\u8c03\u7528 Get.forceAppUpdate() \u65b9\u6cd5\u624d\u6709\u6548\u679c\uff0c\u5982\u679c\u4e0d\u5e0c\u671b\u7528\u6237\u9891\u7e41\u7684\u8c03\u7528 forceAppUpdate\u65b9\u6cd5\uff0c\u53ef\u4ee5\u52a0\u4e00\u5c42\u9632\u6296\u4ee3\u7801\uff0c\u4e5f\u53ef\u4ee5\u5728setThemeMode\u65b9\u6cd5\u4e2d\u7528changeThemeMode\u65b9\u6cd5 \uff0c\u5728setPrimaryColor\u65b9\u6cd5\u4e2d\u8c03\u7528forceAppUpdate\u65b9\u6cd5"})]})}function c(e={}){const{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}},25782:(e,r,t)=>{t.d(r,{A:()=>n});const n=t.p+"assets/images/flutter_theme_getx-53ac526b25a4b4155dc25556668f1b08.gif"},99128:(e,r,t)=>{t.d(r,{R:()=>l,x:()=>i});var n=t(79474);const o={},a=n.createContext(o);function l(e){const r=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),n.createElement(a.Provider,{value:r},e.children)}}}]);